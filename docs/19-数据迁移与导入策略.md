# 19. 数据迁移与导入策略

## 文档概述

本文档详细规划了力通电子网站的数据迁移策略、初始数据导入方案、数据质量保证措施和历史数据处理流程。确保网站上线时具备完整、准确的产品和业务数据。

## 数据源分析

### 现有数据系统盘点

```typescript
// 数据源定义
export interface DataSources {
  // ERP系统数据
  erpSystems: {
    sap: {
      system: 'SAP ECC 6.0';
      database: 'Oracle 12c';
      tables: {
        productMaster: 'MARA';        // 物料主数据
        productText: 'MAKT';          // 物料描述
        pricing: 'KONP';              // 价格条件
        inventory: 'MARD';            // 库存数据
        vendors: 'LFA1';              // 供应商主数据
        customers: 'KNA1';            // 客户主数据
      };
      estimatedRecords: {
        products: 50000;
        customers: 5000;
        vendors: 200;
        pricingRecords: 150000;
        inventoryRecords: 200000;
      };
    };
    
    oracle: {
      system: 'Oracle EBS R12';
      modules: ['Inventory', 'Order Management', 'Purchasing'];
      customizations: string[];
      dataVolume: '500GB';
    };
  };
  
  // 现有网站数据
  legacyWebsite: {
    platform: 'WordPress + WooCommerce';
    database: 'MySQL 5.7';
    dataTypes: {
      products: 1000;               // 现有产品数量
      categories: 50;               // 分类数量
      brands: 30;                   // 品牌数量
      users: 2000;                  // 注册用户
      orders: 5000;                 // 历史订单
      inquiries: 8000;              // 询价记录
    };
    
    contentData: {
      blogPosts: 200;               // 博客文章
      pages: 50;                    // 静态页面
      media: 5000;                  // 媒体文件
      attachments: 1000;            // 附件文档
    };
  };
  
  // Excel和CSV文件
  spreadsheetData: {
    productCatalogs: {
      files: 20;
      averageRecords: 500;
      formats: ['xlsx', 'csv'];
      encoding: 'UTF-8';
    };
    
    priceList: {
      files: 50;
      updateFrequency: 'monthly';
      sources: ['distributors', 'manufacturers'];
    };
    
    technicalDocs: {
      datasheets: 10000;
      applicationNotes: 500;
      referenceDesigns: 200;
      formats: ['pdf', 'doc', 'zip'];
    };
  };
  
  // 第三方数据源
  externalSources: {
    distributorAPIs: {
      arrow: {
        products: 100000;
        realTimeInventory: boolean;
        pricingAccess: boolean;
      };
      
      digikey: {
        products: 500000;
        apiAccess: 'GraphQL';
        rateLimits: '1000/hour';
      };
      
      mouser: {
        products: 300000;
        dataFormat: 'JSON/XML';
        updateFrequency: 'daily';
      };
    };
    
    manufacturerData: {
      intel: { products: 5000; specifications: true };
      stmicroelectronics: { products: 8000; documentation: true };
      ti: { products: 12000; toolsAndSoftware: true };
      infineon: { products: 6000; applicationNotes: true };
    };
  };
}
```

### 数据质量评估

```typescript
// 数据质量评估框架
export interface DataQualityAssessment {
  // 数据完整性检查
  completeness: {
    requiredFields: {
      products: {
        partNumber: 100;          // 必须100%完整
        title: 95;                // 要求95%完整
        description: 80;          // 要求80%完整
        brand: 100;
        category: 100;
        image: 60;                // 要求60%有图片
        datasheet: 40;            // 要求40%有规格书
      };
      
      brands: {
        name: 100;
        logo: 80;
        description: 60;
        website: 50;
      };
      
      categories: {
        name: 100;
        description: 80;
        icon: 70;
      };
    };
    
    missingDataHandling: {
      strategy: 'flag_and_supplement';
      priorityOrder: ['critical', 'important', 'optional'];
      supplementSources: ['manufacturer_api', 'manual_research', 'default_values'];
    };
  };
  
  // 数据准确性检查
  accuracy: {
    validationRules: {
      partNumber: {
        format: /^[A-Z0-9-_]+$/;
        uniqueness: true;
        crossReference: boolean;
      };
      
      pricing: {
        range: { min: 0.01, max: 100000 };
        currency: ['CNY', 'USD', 'EUR'];
        precision: 4;             // 小数点后4位
      };
      
      specifications: {
        unitConsistency: boolean;
        valueRanges: Record<string, { min: number; max: number }>;
        enumValues: Record<string, string[]>;
      };
    };
    
    crossValidation: {
      manufacturerData: boolean;  // 与制造商数据对比
      marketData: boolean;        // 与市场数据对比
      historicalData: boolean;    // 与历史数据对比
    };
  };
  
  // 数据一致性检查
  consistency: {
    namingConventions: {
      partNumbers: 'manufacturer_standard';
      categories: 'hierarchical_naming';
      brands: 'official_naming';
    };
    
    unitStandardization: {
      voltage: 'V';
      current: 'A';
      power: 'W';
      frequency: 'Hz';
      temperature: '°C';
      dimensions: 'mm';
    };
    
    relationshipIntegrity: {
      productBrandConsistency: boolean;
      categoryHierarchy: boolean;
      pricingCurrency: boolean;
    };
  };
  
  // 数据时效性检查
  timeliness: {
    dataFreshness: {
      products: '30 days';        // 产品数据30天内更新
      pricing: '7 days';          // 价格数据7天内更新
      inventory: '1 day';         // 库存数据1天内更新
      specifications: '90 days';  // 规格数据90天内更新
    };
    
    obsoleteDataHandling: {
      identificationCriteria: string[];
      archiveProcess: boolean;
      removalProcess: boolean;
    };
  };
}
```

## 数据迁移架构

### 迁移系统设计

```typescript
// 数据迁移架构
export interface DataMigrationArchitecture {
  // ETL管道设计
  etlPipeline: {
    extraction: {
      sources: DataSource[];
      connectors: {
        database: 'JDBC' | 'ODBC' | 'Native';
        api: 'REST' | 'GraphQL' | 'SOAP';
        file: 'CSV' | 'Excel' | 'JSON' | 'XML';
      };
      
      extractionStrategies: {
        fullExtraction: boolean;    // 全量提取
        incrementalExtraction: boolean; // 增量提取
        changeDataCapture: boolean; // 变更数据捕获
      };
    };
    
    transformation: {
      dataMapping: {
        sourceField: string;
        targetField: string;
        transformationRules: TransformationRule[];
      }[];
      
      dataEnrichment: {
        lookupTables: string[];
        externalAPIs: string[];
        calculatedFields: string[];
      };
      
      dataValidation: {
        businessRules: ValidationRule[];
        dataQualityChecks: QualityCheck[];
        errorHandling: ErrorHandlingStrategy;
      };
    };
    
    loading: {
      targetSystem: 'Sanity CMS';
      loadingStrategies: {
        bulkInsert: boolean;
        batchProcessing: boolean;
        parallelLoading: boolean;
      };
      
      conflictResolution: {
        strategy: 'overwrite' | 'merge' | 'skip' | 'manual';
        keyFields: string[];
        mergeRules: MergeRule[];
      };
    };
  };
  
  // 迁移工具选择
  migrationTools: {
    etlTool: 'Apache NiFi' | 'Talend' | 'Pentaho' | 'Custom Script';
    
    customMigrationFramework: {
      language: 'TypeScript/Node.js';
      libraries: [
        'csv-parser',         // CSV解析
        'xlsx',               // Excel处理
        '@sanity/client',     // Sanity客户端
        'mysql2',             // MySQL连接
        'oracledb',           // Oracle连接
        'pg',                 // PostgreSQL连接
      ];
      
      architecture: {
        configDriven: boolean;      // 配置驱动
        pluginSystem: boolean;      // 插件系统
        errorRecovery: boolean;     // 错误恢复
        progressTracking: boolean;  // 进度跟踪
      };
    };
  };
}

// 数据转换规则
export interface TransformationRules {
  // 产品数据转换
  productTransformation: {
    partNumber: {
      source: 'MARA.MATNR';
      target: 'partNumber';
      rules: [
        { type: 'trim', params: {} },
        { type: 'uppercase', params: {} },
        { type: 'removeLeadingZeros', params: {} }
      ];
    };
    
    title: {
      source: 'MAKT.MAKTX';
      target: 'title';
      rules: [
        { type: 'trim', params: {} },
        { type: 'capitalizeWords', params: {} },
        { type: 'removeSpecialChars', params: { keep: ['-', '/', '(', ')'] } }
      ];
    };
    
    specifications: {
      source: 'MULTIPLE_TABLES';
      target: 'specifications';
      transformation: 'custom_specs_parser';
      rules: [
        { type: 'standardizeUnits', params: { unitMapping: UnitMappingTable } },
        { type: 'validateRanges', params: { specRanges: SpecificationRanges } },
        { type: 'normalizeValues', params: { normalizations: ValueNormalizations } }
      ];
    };
  };
  
  // 品牌数据转换
  brandTransformation: {
    name: {
      source: 'LFA1.NAME1';
      target: 'name';
      rules: [
        { type: 'standardizeBrandName', params: { brandMappings: BrandNameMappings } },
        { type: 'validateBrandName', params: { officialNames: OfficialBrandNames } }
      ];
    };
    
    logo: {
      source: 'CUSTOM_LOGO_TABLE.LOGO_PATH';
      target: 'logo';
      transformation: 'upload_to_sanity_assets';
      rules: [
        { type: 'validateImageFormat', params: { allowedFormats: ['png', 'jpg', 'svg'] } },
        { type: 'optimizeImage', params: { maxWidth: 300, quality: 80 } }
      ];
    };
  };
  
  // 分类数据转换
  categoryTransformation: {
    hierarchy: {
      source: 'CUSTOM_CATEGORY_TABLE';
      target: 'category_hierarchy';
      transformation: 'build_category_tree';
      rules: [
        { type: 'validateHierarchy', params: { maxDepth: 4 } },
        { type: 'generateSlugs', params: { slugStyle: 'kebab-case' } },
        { type: 'assignIcons', params: { iconMappings: CategoryIconMappings } }
      ];
    };
  };
}
```

### 迁移执行计划

```typescript
// 分阶段迁移计划
export interface MigrationExecutionPlan {
  // 第一阶段：基础数据迁移
  phase1: {
    name: '基础数据结构迁移';
    duration: '2周';
    dependencies: [];
    
    tasks: {
      week1: [
        '设置迁移环境和工具',
        '创建数据映射配置',
        '品牌数据迁移和验证',
        '产品分类数据迁移'
      ];
      
      week2: [
        '产品主数据迁移（基础信息）',
        '数据质量检查和修复',
        '基础关联关系建立',
        '第一阶段验收测试'
      ];
    };
    
    deliverables: [
      '品牌数据（完整）',
      '产品分类层级（完整）',
      '产品基础信息（80%）',
      '迁移脚本和配置文件'
    ];
    
    successCriteria: {
      dataCompleteness: 95;      // 数据完整性95%
      dataAccuracy: 98;          // 数据准确性98%
      performanceTarget: '1000 records/minute';
    };
  };
  
  // 第二阶段：详细数据和规格迁移
  phase2: {
    name: '产品详细数据迁移';
    duration: '3周';
    dependencies: ['phase1'];
    
    tasks: {
      week1: [
        '产品规格数据解析和转换',
        '技术参数标准化',
        '产品图片批量处理和上传'
      ];
      
      week2: [
        '价格数据迁移和验证',
        '库存数据同步',
        '产品关联关系建立'
      ];
      
      week3: [
        '技术文档迁移（数据表、应用笔记）',
        '产品描述和SEO数据迁移',
        '第二阶段验收测试'
      ];
    };
    
    deliverables: [
      '产品详细规格（完整）',
      '产品图片和文档（完整）',
      '价格和库存数据（实时同步）',
      '产品关联推荐数据'
    ];
  };
  
  // 第三阶段：业务数据和历史数据
  phase3: {
    name: '业务和历史数据迁移';
    duration: '2周';
    dependencies: ['phase2'];
    
    tasks: {
      week1: [
        '客户数据迁移（脱敏处理）',
        '历史询价记录迁移',
        '订单历史数据迁移'
      ];
      
      week2: [
        '用户行为数据迁移',
        '内容数据迁移（文章、新闻）',
        '搜索和分析历史数据'
      ];
    };
    
    deliverables: [
      '客户主数据（脱敏）',
      '历史业务数据',
      '内容管理数据',
      '分析基础数据'
    ];
  };
  
  // 第四阶段：数据验证和优化
  phase4: {
    name: '全面验证和优化';
    duration: '1周';
    dependencies: ['phase3'];
    
    tasks: [
      '端到端数据完整性验证',
      '数据关联关系验证',
      '性能测试和优化',
      '数据备份和恢复测试',
      '用户验收测试'
    ];
    
    deliverables: [
      '完整的数据验证报告',
      '性能基准测试结果',
      '数据质量评估报告',
      '用户验收确认'
    ];
  };
}
```

## 数据清理和标准化

### 数据清理流程

```typescript
// 数据清理和标准化规则
export interface DataCleansingRules {
  // 重复数据处理
  deduplication: {
    productDeduplication: {
      matchingCriteria: [
        { field: 'partNumber', weight: 0.8, exactMatch: true },
        { field: 'brand', weight: 0.1, exactMatch: true },
        { field: 'title', weight: 0.1, similarity: 0.9 }
      ];
      
      resolutionStrategy: {
        primary: 'most_complete_record';     // 选择最完整的记录
        fallback: 'newest_record';           // 备选：最新记录
        customRules: [
          {
            condition: 'has_datasheet',
            action: 'prefer'
          },
          {
            condition: 'has_image',
            action: 'prefer'
          },
          {
            condition: 'price_available',
            action: 'prefer'
          }
        ];
      };
      
      mergeStrategy: {
        conflictResolution: 'manual_review';  // 冲突需人工审核
        autoMergeThreshold: 0.95;            // 相似度95%以上自动合并
        preserveHistory: true;               // 保留合并历史
      };
    };
    
    brandDeduplication: {
      fuzzyMatching: {
        algorithm: 'levenshtein_distance';
        threshold: 0.9;
        customRules: {
          'ST Microelectronics': ['STM', 'STMicroelectronics', 'ST Micro'],
          'Texas Instruments': ['TI', 'Texas Inst', 'TEXAS INSTRUMENTS']
        };
      };
    };
  };
  
  // 数据标准化
  standardization: {
    partNumbers: {
      rules: [
        { type: 'remove_leading_zeros', apply_to: 'all' },
        { type: 'uppercase', apply_to: 'alphabetic_chars' },
        { type: 'remove_spaces', apply_to: 'all' },
        { type: 'validate_format', pattern: /^[A-Z0-9-_\/]+$/ }
      ];
      
      brandSpecificRules: {
        'Intel': { 
          pattern: /^[A-Z]{2,4}[0-9]{2,6}[A-Z]*$/,
          examples: ['i5-11400F', 'Core i7-10700K']
        },
        'STMicroelectronics': {
          pattern: /^STM32[A-Z][0-9]{3}[A-Z][0-9][A-Z][0-9]$/,
          examples: ['STM32F103C8T6', 'STM32L476RGT6']
        }
      };
    };
    
    specifications: {
      unitStandardization: {
        voltage: {
          inputFormats: ['V', 'v', 'Volt', 'volts', 'VDC', 'VAC'],
          outputFormat: 'V',
          conversionRules: [
            { from: 'mV', to: 'V', factor: 0.001 },
            { from: 'kV', to: 'V', factor: 1000 }
          ]
        };
        
        current: {
          inputFormats: ['A', 'a', 'Amp', 'amps', 'Ampere'],
          outputFormat: 'A',
          conversionRules: [
            { from: 'mA', to: 'A', factor: 0.001 },
            { from: 'µA', to: 'A', factor: 0.000001 }
          ]
        };
        
        temperature: {
          inputFormats: ['°C', '℃', 'C', 'Celsius'],
          outputFormat: '°C',
          conversionRules: [
            { from: '°F', to: '°C', formula: '(x - 32) * 5/9' },
            { from: 'K', to: '°C', formula: 'x - 273.15' }
          ]
        };
      };
      
      valueNormalization: {
        packageTypes: {
          'SOIC-8': ['SO8', 'SOIC8', 'SOP8', 'SOP-8'],
          'QFN-32': ['QFN32', 'VQFN32', 'MLF32'],
          'BGA-144': ['BGA144', 'FBGA144', 'LFBGA144']
        };
        
        tolerances: {
          standardFormat: '±X%',
          inputFormats: ['+/-X%', '± X%', '+/- X%', 'X% tolerance']
        };
      };
    };
    
    descriptions: {
      cleaningRules: [
        { type: 'remove_extra_spaces', pattern: /\s+/g, replacement: ' ' },
        { type: 'fix_punctuation', rules: [
          { pattern: /\s+,/g, replacement: ',' },
          { pattern: /\s+\./g, replacement: '.' }
        ]},
        { type: 'capitalize_sentences', pattern: /^\w|\.\s*\w/g },
        { type: 'remove_trailing_punctuation', pattern: /[,;:]$/ }
      ];
      
      contentEnrichment: {
        addMissingPeriods: boolean;
        expandAbbreviations: {
          'MCU': 'Microcontroller Unit',
          'IC': 'Integrated Circuit',
          'PCB': 'Printed Circuit Board'
        };
        generateSummary: boolean;       // 为长描述生成摘要
      };
    };
  };
  
  // 数据验证
  validation: {
    businessRules: [
      {
        name: 'price_range_validation',
        condition: 'price > 0 AND price < 1000000',
        action: 'flag_for_review'
      },
      {
        name: 'inventory_consistency',
        condition: 'inventory >= 0',
        action: 'set_to_zero'
      },
      {
        name: 'category_brand_consistency',
        condition: 'brand_categories_match',
        action: 'flag_inconsistency'
      }
    ];
    
    dataIntegrity: [
      {
        name: 'required_fields_check',
        fields: ['partNumber', 'title', 'brand', 'category'],
        action: 'reject_record'
      },
      {
        name: 'foreign_key_validation',
        relationships: [
          { table: 'products', field: 'brandId', references: 'brands.id' },
          { table: 'products', field: 'categoryId', references: 'categories.id' }
        ],
        action: 'flag_broken_reference'
      }
    ];
  };
}
```

### 自动化清理工具

```typescript
// 自动化数据清理服务
export class DataCleansingService {
  // 执行完整的数据清理流程
  async performFullCleansing(dataset: RawDataset): Promise<CleansingResult> {
    const result: CleansingResult = {
      totalRecords: dataset.records.length,
      processedRecords: 0,
      cleanedRecords: 0,
      rejectedRecords: 0,
      warnings: [],
      errors: [],
      statistics: {}
    };
    
    // 阶段1：重复数据检测和合并
    const deduplicationResult = await this.performDeduplication(dataset);
    result.statistics.deduplication = deduplicationResult;
    
    // 阶段2：数据标准化
    const standardizationResult = await this.performStandardization(
      deduplicationResult.cleanedData
    );
    result.statistics.standardization = standardizationResult;
    
    // 阶段3：数据验证
    const validationResult = await this.performValidation(
      standardizationResult.cleanedData
    );
    result.statistics.validation = validationResult;
    
    // 阶段4：数据增强
    const enrichmentResult = await this.performEnrichment(
      validationResult.validData
    );
    result.statistics.enrichment = enrichmentResult;
    
    // 生成清理报告
    result.cleanedRecords = enrichmentResult.processedRecords;
    result.processedRecords = dataset.records.length;
    
    return result;
  }
  
  // 重复数据处理
  async performDeduplication(dataset: RawDataset): Promise<DeduplicationResult> {
    const duplicateGroups = await this.findDuplicates(dataset);
    const mergedRecords = [];
    
    for (const group of duplicateGroups) {
      if (group.similarity >= this.config.autoMergeThreshold) {
        // 自动合并
        const mergedRecord = await this.autoMergeRecords(group.records);
        mergedRecords.push(mergedRecord);
      } else {
        // 标记为需要人工审核
        await this.flagForManualReview(group);
        mergedRecords.push(group.primaryRecord);
      }
    }
    
    return {
      originalCount: dataset.records.length,
      duplicatesFound: duplicateGroups.length,
      autoMerged: mergedRecords.filter(r => r.autoMerged).length,
      manualReviewRequired: duplicateGroups.filter(g => 
        g.similarity < this.config.autoMergeThreshold
      ).length,
      cleanedData: mergedRecords
    };
  }
  
  // 数据标准化处理
  async performStandardization(records: DataRecord[]): Promise<StandardizationResult> {
    const standardizedRecords = [];
    const errors = [];
    
    for (const record of records) {
      try {
        const standardizedRecord = await this.applyStandardizationRules(record);
        standardizedRecords.push(standardizedRecord);
      } catch (error) {
        errors.push({
          recordId: record.id,
          error: error.message,
          originalData: record
        });
      }
    }
    
    return {
      processedRecords: records.length,
      successfullyStandardized: standardizedRecords.length,
      errors: errors,
      cleanedData: standardizedRecords
    };
  }
  
  // 数据验证
  async performValidation(records: DataRecord[]): Promise<ValidationResult> {
    const validRecords = [];
    const invalidRecords = [];
    const warnings = [];
    
    for (const record of records) {
      const validationResults = await this.validateRecord(record);
      
      if (validationResults.isValid) {
        validRecords.push(record);
        
        if (validationResults.warnings.length > 0) {
          warnings.push({
            recordId: record.id,
            warnings: validationResults.warnings
          });
        }
      } else {
        invalidRecords.push({
          record,
          errors: validationResults.errors
        });
      }
    }
    
    return {
      totalRecords: records.length,
      validRecords: validRecords.length,
      invalidRecords: invalidRecords.length,
      warnings: warnings,
      validData: validRecords,
      invalidData: invalidRecords
    };
  }
  
  // 数据增强
  async performEnrichment(records: DataRecord[]): Promise<EnrichmentResult> {
    const enrichedRecords = [];
    
    for (const record of records) {
      const enrichedRecord = { ...record };
      
      // 添加缺失的SEO数据
      if (!enrichedRecord.seoTitle) {
        enrichedRecord.seoTitle = this.generateSEOTitle(record);
      }
      
      if (!enrichedRecord.seoDescription) {
        enrichedRecord.seoDescription = this.generateSEODescription(record);
      }
      
      // 生成URL slug
      if (!enrichedRecord.slug) {
        enrichedRecord.slug = this.generateSlug(record.title);
      }
      
      // 添加分类路径
      enrichedRecord.categoryPath = await this.buildCategoryPath(record.categoryId);
      
      // 添加品牌信息
      enrichedRecord.brandInfo = await this.enrichBrandInfo(record.brandId);
      
      enrichedRecords.push(enrichedRecord);
    }
    
    return {
      processedRecords: records.length,
      enrichedFields: this.calculateEnrichedFields(enrichedRecords),
      enrichedData: enrichedRecords
    };
  }
}
```

## 数据质量保证

### 质量监控系统

```typescript
// 数据质量监控配置
export interface DataQualityMonitoring {
  // 实时质量检查
  realTimeChecks: {
    incomingDataValidation: {
      enabled: boolean;
      validationRules: ValidationRule[];
      rejectionThreshold: number;        // 拒绝阈值：错误率>5%拒绝批次
      alertThreshold: number;            // 告警阈值：错误率>2%发送告警
    };
    
    anomalyDetection: {
      priceAnomalies: {
        enabled: boolean;
        methods: ['statistical_outlier', 'machine_learning'];
        thresholds: {
          priceDeviationPercent: 50;     // 价格偏差超过50%
          inventoryFluctuation: 200;     // 库存波动超过200%
        };
      };
      
      dataPatternAnomalies: {
        newBrandDetection: boolean;      // 新品牌检测
        unusualCategoryAssignment: boolean; // 异常分类分配
        specificationOutliers: boolean;   // 规格异常值
      };
    };
    
    completenessMonitoring: {
      requiredFieldsCheck: {
        products: {
          critical: ['partNumber', 'title', 'brand', 'category'];
          important: ['description', 'image', 'specifications'];
          optional: ['datasheet', 'applicationNotes'];
        };
        
        alertRules: [
          {
            condition: 'critical_field_missing_rate > 1%',
            action: 'immediate_alert'
          },
          {
            condition: 'important_field_missing_rate > 10%',
            action: 'daily_report'
          }
        ];
      };
    };
  };
  
  // 定期质量评估
  periodicAssessment: {
    dailyChecks: [
      'data_freshness_check',           // 数据时效性检查
      'duplicate_detection',            // 重复数据检测
      'referential_integrity',          // 引用完整性
      'price_consistency'               // 价格一致性
    ];
    
    weeklyChecks: [
      'comprehensive_duplicate_analysis', // 全面重复分析
      'category_distribution_analysis',   // 分类分布分析
      'brand_portfolio_consistency',      // 品牌组合一致性
      'specification_standardization'     // 规格标准化检查
    ];
    
    monthlyChecks: [
      'data_lineage_audit',              // 数据血缘审计
      'cross_system_reconciliation',     // 跨系统对账
      'historical_trend_analysis',       // 历史趋势分析
      'external_data_validation'         // 外部数据验证
    ];
  };
  
  // 质量指标定义
  qualityMetrics: {
    completeness: {
      calculation: 'filled_fields / total_fields * 100';
      target: 95;                        // 目标：95%完整性
      minimum: 90;                       // 最低：90%完整性
    };
    
    accuracy: {
      calculation: 'correct_values / total_values * 100';
      target: 98;                        // 目标：98%准确性
      minimum: 95;                       // 最低：95%准确性
      
      validationMethods: [
        'cross_reference_validation',     // 交叉引用验证
        'business_rule_validation',       // 业务规则验证
        'external_source_validation'      // 外部数据源验证
      ];
    };
    
    consistency: {
      calculation: 'consistent_records / total_records * 100';
      target: 99;                        // 目标：99%一致性
      minimum: 97;                       // 最低：97%一致性
      
      consistencyChecks: [
        'naming_convention_consistency',   // 命名规范一致性
        'format_consistency',             // 格式一致性
        'relationship_consistency'        // 关系一致性
      ];
    };
    
    timeliness: {
      calculation: 'up_to_date_records / total_records * 100';
      target: 95;                        // 目标：95%时效性
      minimum: 90;                       // 最低：90%时效性
      
      freshnessThresholds: {
        critical_data: '24 hours',        // 关键数据24小时
        important_data: '7 days',         // 重要数据7天
        reference_data: '30 days'         // 参考数据30天
      };
    };
  };
}
```

### 数据治理框架

```typescript
// 数据治理框架
export interface DataGovernanceFramework {
  // 数据管理角色
  dataRoles: {
    dataOwner: {
      responsibilities: [
        '定义数据业务规则',
        '批准数据访问权限',
        '确保数据质量标准',
        '解决数据冲突'
      ];
      authority: 'business_decision_making';
    };
    
    dataSteward: {
      responsibilities: [
        '执行数据质量检查',
        '维护数据字典',
        '监控数据使用',
        '处理数据问题'
      ];
      authority: 'operational_data_management';
    };
    
    dataCustodian: {
      responsibilities: [
        '实施技术控制措施',
        '维护数据基础设施',
        '执行备份和恢复',
        '确保数据安全'
      ];
      authority: 'technical_data_management';
    };
  };
  
  // 数据生命周期管理
  dataLifecycle: {
    creation: {
      dataSourceRegistration: boolean;   // 数据源注册
      qualityValidation: boolean;        // 质量验证
      metadataCapture: boolean;          // 元数据捕获
      approvalWorkflow: boolean;         // 审批流程
    };
    
    usage: {
      accessLogging: boolean;            // 访问日志记录
      usageMonitoring: boolean;          // 使用监控
      performanceTracking: boolean;      // 性能跟踪
      complianceChecking: boolean;       // 合规检查
    };
    
    maintenance: {
      regularQualityChecks: boolean;     // 定期质量检查
      dataRefreshSchedule: boolean;      // 数据刷新计划
      errorCorrectionProcess: boolean;   // 错误纠正流程
      versionControl: boolean;           // 版本控制
    };
    
    archival: {
      archivalCriteria: {
        dataAge: '7 years';              // 数据年龄
        accessFrequency: 'monthly';       // 访问频率
        businessValue: 'low';            // 业务价值
      };
      
      archivalProcess: {
        dataCompression: boolean;         // 数据压缩
        accessibleStorage: boolean;       // 可访问存储
        retrievalProcess: boolean;        // 检索流程
      };
    };
    
    disposal: {
      disposalCriteria: {
        legalRequirement: boolean;        // 法律要求
        businessNeed: boolean;            // 业务需要
        securityRisk: boolean;            // 安全风险
      };
      
      disposalProcess: {
        secureErasure: boolean;           // 安全擦除
        certificateGeneration: boolean;   // 证书生成
        auditTrail: boolean;              // 审计跟踪
      };
    };
  };
  
  // 数据字典管理
  dataDictionary: {
    businessGlossary: {
      terms: {
        partNumber: '产品唯一标识符，由制造商分配';
        leadTime: '从订单确认到交付的预计时间';
        moq: '最小订购量，购买该产品的最小数量要求';
      };
      
      relationships: {
        'product -> brand': '多对一关系，每个产品属于一个品牌';
        'product -> category': '多对一关系，每个产品属于一个分类';
        'category -> parent': '自引用关系，支持分类层级结构';
      };
    };
    
    technicalMetadata: {
      dataTypes: {
        partNumber: 'VARCHAR(50) NOT NULL UNIQUE';
        price: 'DECIMAL(10,4) DEFAULT NULL';
        inventory: 'INTEGER DEFAULT 0';
        createdAt: 'TIMESTAMP DEFAULT CURRENT_TIMESTAMP';
      };
      
      constraints: {
        partNumber: ['NOT NULL', 'UNIQUE', 'LENGTH > 3'];
        price: ['>= 0', 'DECIMAL(10,4)'];
        categoryId: ['FOREIGN KEY REFERENCES categories(id)'];
      };
      
      indexes: {
        products: ['partNumber', 'brandId', 'categoryId', 'isActive'];
        categories: ['slug', 'parentId', 'level'];
        brands: ['slug', 'isActive'];
      };
    };
  };
}
```

## 实施时间线与预算

### 详细实施计划

```yaml
数据迁移项目总体规划:
  
  准备阶段 (1周):
    任务:
      - 数据源调研和映射
      - 迁移工具选择和环境搭建
      - 测试数据准备
      - 团队培训
    交付物:
      - 数据源分析报告
      - 迁移架构设计文档
      - 工具配置和测试环境
    预算: $8,000
  
  第一阶段 - 基础数据迁移 (2周):
    任务:
      - 品牌和分类数据迁移
      - 产品基础信息迁移
      - 数据清理和标准化
      - 第一轮质量检查
    交付物:
      - 品牌数据（100%）
      - 产品分类（100%）
      - 产品基础信息（80%）
    预算: $15,000
  
  第二阶段 - 详细数据迁移 (3周):
    任务:
      - 产品详细规格迁移
      - 图片和文档资产迁移
      - 价格和库存数据迁移
      - 产品关联关系建立
    交付物:
      - 完整产品数据库
      - 媒体资产库
      - 实时价格库存同步
    预算: $22,000
  
  第三阶段 - 业务数据迁移 (2周):
    任务:
      - 历史订单和询价数据
      - 客户数据迁移（脱敏）
      - 内容数据迁移
      - 用户行为数据
    交付物:
      - 完整业务历史数据
      - 客户关系数据
      - 内容管理系统数据
    预算: $18,000
  
  验证和优化阶段 (1周):
    任务:
      - 端到端数据验证
      - 性能测试和优化
      - 用户验收测试
      - 文档完善
    交付物:
      - 数据质量报告
      - 性能测试报告
      - 用户操作手册
      - 项目总结报告
    预算: $10,000

总预算: $73,000
总工期: 9周
团队规模: 
  - 数据工程师: 2人
  - 数据分析师: 1人
  - 质量保证工程师: 1人
  - 项目经理: 1人
```

### 风险管理计划

```typescript
// 数据迁移风险管理
export interface MigrationRiskManagement {
  // 风险识别和评估
  identifiedRisks: {
    dataQualityRisks: {
      risk: '源数据质量差导致迁移失败';
      probability: 'Medium';
      impact: 'High';
      mitigation: [
        '提前进行数据质量评估',
        '建立数据清理流程',
        '设置质量门禁检查',
        '准备数据修复工具'
      ];
    };
    
    performanceRisks: {
      risk: '大数据量迁移导致性能问题';
      probability: 'Medium';
      impact: 'Medium';
      mitigation: [
        '分批处理数据迁移',
        '使用并行处理技术',
        '优化数据库连接池',
        '监控资源使用情况'
      ];
    };
    
    dataLossRisks: {
      risk: '迁移过程中数据丢失或损坏';
      probability: 'Low';
      impact: 'Critical';
      mitigation: [
        '完整数据备份策略',
        '事务性迁移操作',
        '增量迁移和验证',
        '回滚计划准备'
      ];
    };
    
    timelineRisks: {
      risk: '迁移时间超出预期影响上线';
      probability: 'Medium';
      impact: 'High';
      mitigation: [
        '详细的时间规划',
        '并行处理策略',
        '关键路径识别',
        '应急资源准备'
      ];
    };
    
    integrationRisks: {
      risk: '第三方系统集成失败';
      probability: 'Medium';
      impact: 'Medium';
      mitigation: [
        '早期集成测试',
        'API稳定性验证',
        '备用数据源准备',
        '降级方案设计'
      ];
    };
  };
  
  // 应急响应计划
  contingencyPlans: {
    dataCorruption: {
      detectionMethods: [
        '校验和验证',
        '自动化完整性检查',
        '抽样验证',
        '业务规则验证'
      ];
      
      responseActions: [
        '立即停止迁移过程',
        '恢复到最近备份点',
        '分析损坏原因',
        '修复后重新开始'
      ];
    };
    
    performanceDegradation: {
      monitoringMetrics: [
        '迁移吞吐量',
        '系统资源使用率',
        '数据库锁等待',
        '错误率监控'
      ];
      
      optimizationActions: [
        '调整批处理大小',
        '增加并行度',
        '优化查询语句',
        '临时扩容资源'
      ];
    };
    
    timelineDelay: {
      criticalPathManagement: [
        '识别关键依赖',
        '资源重新分配',
        '并行任务调整',
        '范围优先级调整'
      ];
      
      accelerationStrategies: [
        '增加团队人力',
        '延长工作时间',
        '简化验证流程',
        '推迟非关键功能'
      ];
    };
  };
  
  // 质量保证措施
  qualityAssurance: {
    testingStrategy: {
      unitTesting: '每个迁移组件单独测试';
      integrationTesting: '端到端数据流验证';
      performanceTesting: '大数据量性能测试';
      userAcceptanceTesting: '业务用户验收测试';
    };
    
    validationChecklist: [
      '数据计数对比验证',
      '关键字段完整性检查',
      '业务规则验证',
      '关联关系完整性',
      '数据格式标准性',
      '性能基准达标'
    ];
    
    rollbackProcedures: {
      triggerConditions: [
        '数据丢失率 > 0.1%',
        '性能下降 > 50%',
        '关键功能失效',
        '业务验收不通过'
      ];
      
      rollbackSteps: [
        '停止所有迁移进程',
        '恢复数据库到备份点',
        '重置系统配置',
        '验证系统正常运行',
        '分析问题原因',
        '制定修复计划'
      ];
    };
  };
}
```

---

**文档版本**: v1.0  
**创建日期**: 2025-09-06  
**适用范围**: 力通电子网站数据迁移团队

**项目总结**: 完整的数据迁移和导入策略确保了从各种数据源到新网站的顺利过渡，包括全面的数据清理、质量保证和风险管理措施。